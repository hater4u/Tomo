{% extends 'index.html' %}

{% block body %}

<main class="container">
    <br>
    <br>

    <h3>Добавление нового эксперимента</h3>

       <form action="/experiment/change/{{ experiment.id }}/" method="post" class="experiments_form">
        {% csrf_token %}
        <div class="form-group">
            <label for="experimentName">Имя эксперимента</label>
            <input type="text" class="form-control" id="experimentName" name="experimentName" aria-describedby="experimentNameHelp" required value="{{ experiment.name }}">
            <small id="experimentNameHelp" class="form-text text-muted">Имя эксперимента, пока без кириллицы</small>
        </div>

        <div class="form-group">
            <label for="taxonSearchName">Имя таксона</label>
            <input type="text" class="form-control" id="taxonSearchName" name="taxonSearchName" aria-describedby="taxonNameHelp" required  value="{{ experiment.taxon_name }}">
            <small id="taxonNameHelp" class="form-text text-muted">Каждый таксон имеет имя</small>
        </div>

        <div class="taxons-hierarchy">

        </div>

        <div class="form-row">
            <div class="col">
                <label class="form-check-label">Образ жизни: </label>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="wayOfLife" id="diurnalWayRadio" value="DIURNAL" {% if experiment.wayOfLife == 'DIURNAL' %}checked {% endif %}>
                    <label class="form-check-label" for="diurnalWayRadio">Дневное</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="wayOfLife" id="nocturalWayRadio" value="NOCTURNAL" {% if experiment.wayOfLife == 'NOCTURNAL' %}checked {% endif %}>
                    <label class="form-check-label" for="nocturalWayRadio">Ночное</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="wayOfLife" id="twilightWayRadio" value="TWILIGHT" {% if experiment.wayOfLife == 'TWILIGHT' %}checked {% endif %}>
                    <label class="form-check-label" for="twilightWayRadio">Сумеречное</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="wayOfLife" id="otherWayRadio" value="OTHER" {% if experiment.wayOfLife == 'OTHER' %}checked {% endif %}>
                    <label class="form-check-label" for="otherWayRadio">Другое</label>
                </div>
            </div>


            <div class="col">
                <label class="form-check-label">Ареал обитания: </label>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="habitat" id="wildHabitatRadio" value="WILD" {% if experiment.habitat == 'WILD' %}checked {% endif %}>
                    <label class="form-check-label" for="wildHabitatRadio">Дикой</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="habitat" id="laboratoryHabitatRadio" value="LABORATORY" {% if experiment.habitat == 'LABORATORY' %}checked {% endif %}>
                    <label class="form-check-label" for="laboratoryHabitatRadio">Лабораторное</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="habitat" id="farmHabitatRadio" value="FARM" {% if experiment.habitat == 'FARM' %}checked {% endif %}>
                    <label class="form-check-label" for="farmHabitatRadio">Фермерское</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="habitat" id="otherHabitatRadio" value="OTHER" {% if experiment.habitat == 'OTHER' %}checked {% endif %}>
                    <label class="form-check-label" for="otherHabitatRadio">Другое</label>
                </div>
            </div>


            <div class="col">


                <label class="form-check-label">Пол: </label>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="gender" id="maleGenderRadio" value="MALE" {% if experiment.gender == 'MALE' %}checked {% endif %}>
                    <label class="form-check-label" for="maleGenderRadio">Мужской</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="gender" id="femaleGenderRadioRadio" value="FEMALE" {% if experiment.gender == 'FEMALE' %}checked {% endif %}>
                    <label class="form-check-label" for="femaleGenderRadioRadio">Женский</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="gender" id="otherGenderRadio" value="OTHER" {% if experiment.gender == 'OTHER' %}checked {% endif %}>
                    <label class="form-check-label" for="otherGenderRadio">Другой</label>
                </div>
            </div>
        </div>

        <br>
        <br>

        <div class="form-row">
            <div class="col">
                <label for="monthsAge">Возраст</label>
                <input type="number" class="form-control" min="0" id="monthsAge" name="monthsAge" aria-describedby="monthsAgeHelp" value="{{ experiment.monthsAge }}" required>
                <small id="monthsAgeHelp" class="form-text text-muted">Возраст в месяцах</small>
            </div>

            <div class="col">
                <label for="weight">Вес</label>
                <input type="number" step="0.01" class="form-control" min="0" id="weight" name="weight" aria-describedby="weightHelp" value="{{ experiment.weight }}" required>
                <small id="weightHelp" class="form-text text-muted">Вес в килограммах</small>
            </div>

            <div class="col">
                <label for="length">Длина</label>
                <input type="number" step="0.01" class="form-control" min="0" id="length" name="length" aria-describedby="lengthHelp" value="{{ experiment.length }}" required>
                <small id="lengthHelp" class="form-text text-muted">Длина в сантиметрах</small>
            </div>
        </div>

        <br>
        <br>


        <div class="form-row">
            <div class="col">
                <h6>Факторы среды</h6>
                <div class="environmentalFactors">

                    {% for el in experiment.environmentalFactors %}
                        <div>
                            <label for="environmentalFactor{{ forloop.counter }}"> Фактор {{ forloop.counter }}</label>
                            <input type="text" class="form-control" id="environmentalFactor{{ forloop.counter }}" name="environmentalFactors" value="{{ el }}" required>
                        </div>
                    {% endfor %}

                </div>
                <br>
                <div class="btn btn-success btn-sm" onclick="addAdditionalField(this)" data-inputtype="environmentalFactors">Добавить ещё один фактор</div>
                <div class="btn btn-danger btn-sm" onclick="deleteLastField(this)" data-inputtype="environmentalFactors">Удалить последний фактор</div>
            </div>
            <div class="col">
                <h6>Заболевания</h6>
                <div class="diseases">

                    {% for el in experiment.diseases %}
                        <div>
                            <label for="disease{{ forloop.counter }}"> Заболевание {{ forloop.counter }}</label>
                            <input type="text" class="form-control" id="disease{{ forloop.counter }}" name="diseases" value="{{ el }}" required>
                        </div>

                    {% endfor %}

                </div>
                <br>
                <div class="btn btn-success btn-sm" onclick="addAdditionalField(this)" data-inputtype="diseases">Добавить ещё одно заболевание</div>
                <div class="btn btn-danger btn-sm" onclick="deleteLastField(this)" data-inputtype="diseases">Удалить последнее заболевание</div>
            </div>
        </div>

        <br>
        <br>


        <div class="form-row">
            <div class="col">
                <label for="withdrawPlace">Место забора</label>
                <input type="text" class="form-control" id="withdrawPlace" name="withdrawPlace" aria-describedby="withdrawPlaceHelp" value="{{ experiment.withdrawPlace }}">
                <small id="withdrawPlaceHelp" class="form-text text-muted">Строка</small>
            </div>
            <div class="col">
                <label for="withdrawDate">Время забора</label>
                <input type="date" class="form-control" id="withdrawDate" name="withdrawDate" aria-describedby="withdrawDateHelp" value="{{ experiment.withdrawDate }}">
                <small id="withdrawDateHelp" class="form-text text-muted">Дата, начиная с 00:00:00 выбранного дня</small>
            </div>
        </div>

        <br>


        <div class="form-row">
            <div class="col">
                <h6>Условия забора</h6>
                <div class="withdrawConditions">

                    {% for el in experiment.withdrawConditions %}
                        <div>
                            <label for="withdrawCondition{{ forloop.counter }}"> Условие забора {{ forloop.counter }}</label>
                            <input type="text" class="form-control" id="withdrawCondition{{ forloop.counter }}" name="withdrawConditions" value="{{ el }}" required>
                        </div>
                    {% endfor %}

                </div>
                <br>
                <div class="btn btn-success btn-sm" onclick="addAdditionalField(this)" data-inputtype="withdrawConditions">Добавить ещё одно условие забора</div>
                <div class="btn btn-danger btn-sm" onclick="deleteLastField(this)" data-inputtype="withdrawConditions">Удалить последнее условие забора</div>
            </div>
            <div class="col">
                <h6>Комментарии</h6>
                <div class="comments">

                    {% for el in experiment.comments %}
                        <div>
                            <label for="comment{{ forloop.counter }}"> Комментарий {{ forloop.counter }}</label>
                            <input type="text" class="form-control" id="comment{{ forloop.counter }}" name="comments" value="{{ el }}" required>
                        </div>

                    {% endfor %}

                </div>
                <br>
                <div class="btn btn-success btn-sm" onclick="addAdditionalField(this)" data-inputtype="comments">Добавить ещё один комментарий</div>
                <div class="btn btn-danger btn-sm" onclick="deleteLastField(this)" data-inputtype="comments">Удалить последний комментарий</div>
            </div>
        </div>
        <br>
        <br>


        <div class="form-row">
            <div class="col">
                <label for="hoursPostMortem">Время с момента смерти</label>
                <input type="number" class="form-control" min="0" id="hoursPostMortem" name="hoursPostMortem" aria-describedby="hoursPostMortemHelp" value="{{ experiment.hoursPostMortem }}" required>
                <small id="hoursPostMortemHelp" class="form-text text-muted">Время в часах</small>
            </div>
            <div class="col">
                <label for="temperature">Температура</label>
                <input type="number" step="0.01" class="form-control" min="0" id="temperature" name="temperature" aria-describedby="temperatureHelp" value="{{ experiment.temperature }}" required>
                <small id="temperatureHelp" class="form-text text-muted">Температура в градусах Цельсия</small>
            </div>
        </div>

        <div class="form-group">
            <h6>Дополнительные свойства</h6>
            <div class="additionalProperties">

                {% for key, value in experiment.additionalProperties.items %}
                    <div class="form-row">
                        <div class="col">
                            <label for="propKey{{ forloop.counter }}"> Ключ {{ forloop.counter }}</label>
                            <input type="text" class="form-control" id="propKey{{ forloop.counter }}" data-hiddenid="hiddenFieldId{{ forloop.counter }}" value="{{ key }}" required>
                        </div>

                        <div class="col">
                            <label for="propValue{{ forloop.counter }}"> Значение {{ forloop.counter }}</label>
                            <input type="text" class="form-control" id="propValue{{ forloop.counter }}" data-hiddenid="hiddenFieldId{{ forloop.counter }}" value="{{ value }}" required>
                        </div>
                        <input id="hiddenFieldId{{ forloop.counter }}" type="hidden" data-keyvalue="true">
                    </div>

                {% endfor %}
            </div>
            <br>
        </div>

        <div class="btn btn-success btn-sm" onclick="addAdditionalField(this)" data-inputtype="additionalProperties">Добавить ещё одно свойство</div>
        <div class="btn btn-danger btn-sm" onclick="deleteLastField(this)" data-inputtype="additionalProperties">Удалить последнее свойство</div>

        <br>
        <br>


        <div class="form-group">
            <h6>Метаболиты</h6>
            <div class="metabolites">
                {% for el in experiment.metabolites %}
                    <div class="form-row">
                        <div class="col">
                            <label for="pubChemCid{{ forloop.counter }}"> pubChemCid {{ forloop.counter }}</label>
                            <input type="number" min="0" class="form-control" id="pubChemCid{{ forloop.counter }}" name="pubChemCid{{ forloop.counter }}" data-metabolite="true" value="{{ el.pubChemCid }}" required>
                        </div>

                        <div class="col">
                            <label for="metaName{{ forloop.counter }}"> Имя метаболита {{ forloop.counter }}</label>
                            <input type="text" class="form-control" id="metaName{{ forloop.counter }}" name="metaName{{ forloop.counter }}" data-metabolite="true" value="{{ el.name }}" required>
                        </div>

                        <div class="col">
                            <label for="concentration{{ forloop.counter }}"> Концентрация {{ forloop.counter }}</label>
                            <input type="number" min="0" step="0.01" class="form-control" id="concentration{{ forloop.counter }}" name="concentration{{ forloop.counter }}" data-metabolite="true" value="{{ el.concentration }}" required>
                        </div>

                        <div class="col">
                            <label for="analysisMethod{{ forloop.counter }}"> Название метода анализа {{ forloop.counter }}</label>
                            <input type="text" class="form-control" id="analysisMethod{{ forloop.counter }}" name="analysisMethod{{ forloop.counter }}" data-metabolite="true" value="{{ el.analysisMethod }}" required>
                        </div>
                    </div>

                {% endfor %}
            </div>
            <br>
            <div class="btn btn-success btn-sm" onclick="addAdditionalField(this)" data-inputtype="metabolites">Добавить ещё один метаболит</div>
            <div class="btn btn-danger btn-sm" onclick="deleteLastField(this)" data-inputtype="metabolites">Удалить последний метаболит</div>
        </div>

        <br>
        <br>

        <div class="form-row">
            <div class="col">
                <h6>Пути файлов</h6>
                <div class="filepaths">
{#                    {% for el in experiment.fileInfos %}#}
{#                        <div>#}
{#                            <label for="filepath{{ forloop.counter }}"> Путь {{ forloop.counter }}</label>#}
{#                            <input type="text" class="form-control" id="filepath{{ forloop.counter }}" name="filepaths" value="{{ el.filepath }}" required>#}
{#                        </div>#}
{#                    {% endfor %}#}
                    {%  for el in experiment.fileInfos %}

                        <div aria-label="breadcrumb">
                            <input type="hidden" id="filepath{{ forloop.counter }}" name="filepaths" value="{{ el.filepath }}">
                            <label>Путь {{ forloop.counter }}</label>
                            <ol id="bc{{ forloop.counter }}" class="breadcrumb bc-ol" data-id="{{ forloop.counter }}">
                                <li class="breadcrumb-item">Корень</li>
                            </ol>
                            <div class="filesdirs{{ forloop.counter }}"></div>
                        </div>

                    {% endfor %}
                </div>
                <br>
                <div class="btn btn-success btn-sm" onclick="addAdditionalField(this)" data-inputtype="filepaths">Добавить ещё один путь</div>
                <div class="btn btn-danger btn-sm" onclick="deleteLastField(this)" data-inputtype="filepaths">Удалить последний путь</div>
            </div>

            <div class="col"></div>
        </div>

        <br>
        <br>
        <div class="response">
        {% if success != None %}
        {% if success %}
        <div class="alert alert-success">
            {{ message }}
        </div>
        {% else %}
        <div class="alert alert-danger">
            {{ message }}
        </div>
        {% endif %}
        {% endif %}
        </div>

        <button type="submit" class="btn btn-primary">Изменить</button>

    </form>

    <br>
    <br>


</main>

{% endblock %}